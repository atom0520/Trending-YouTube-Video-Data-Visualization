<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="css/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="scripts/datamaps.world.min.js"></script>
<script src="scripts/datamaps.all.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>

<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        /* font-family: "Times New Roman", Georgia, Serif; */
        }
    h1,h2,h3,h4,h5,h6 {
        font-family: "Playfair Display";
        letter-spacing: 5px;
    }

    /* Style tab links */
    .tablink {
        background-color: #555;
        color: white;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        font-size: 17px;
        width: 15%;
        margin: 5%;
    }

    .tabcontent {
      /* color: white; */
      display: none;
      padding: 0px 20px;
      height: 100%;
    }

    img     {   width:128px;}
    caption {   background-color:red; 
                color:white;
                border:1px dotted;
                font:bold 22px arial; 
                border-radius: 10px 10px 0px 0px; 
                height:40px; 
                margin: 0px 0px 4px 0px; 
                vertical-align:middle;
                }

    th      {   background-color:red; 
                color:white;
                font:bold 18px arial;
                height:40px;
                padding:2px;
                }
    td      {   border:1px dotted; padding:2px; font-size:14px;}

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }

    .bar {
      fill: orange;
    }

    .bar:hover {
      fill: orangered ;
    }

    .x.axis path {
      display: none;
    }

    .d3-tip {
      line-height: 1;
      font-weight: bold;
      padding: 12px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      border-radius: 2px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
      box-sizing: border-box;
      display: inline;
      font-size: 10px;
      /* width: 100%; */
      line-height: 1;
      color: rgba(0, 0, 0, 0.8);
      content: "\25BC";
      position: absolute;
      text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
      margin: -1px -1px 0 0;
      top: 100%;
      left: 50%;
    }

    .container {

        width: 100%;
        max-width: 640px;
        min-width: 330px;
        background: #fff;
        margin-left: auto;
        margin-right: auto;
        /* margin: 10 10 10 10; */
        margin-top: 40px;
        margin-bottom: 40px;
        /* padding: 0px 0px 20px 0px; */
    }

    .vid-container {
        position: relative;
        padding-bottom: 52%;
        padding-top: 30px; 
        height: 0; 
        background-color:lightgrey;
    }
    
    .vid-container iframe,
    .vid-container object,
    .vid-container embed {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .vid-list-container {
        /* width: 100%; */
        overflow-y: hidden;
        overflow-x: scroll;
        padding: 0px 0px 0px 0px;
        /* margin-left:4%; */
        /* padding-bottom: 20px; */
        /* background-color:rgba(0, 0, 0, 0.8); */
        border: 1px dotted grey;
    }

    .vid-list {
        width: 1480px;
        position: relative;
        /* top:0;
        left: 0; */
        
    }

    .vid-item {
        display: block;
        width: 148px;
        height: 128px;
        float: left;
        margin: 0;
        padding: 10px 10px 10px 10px;
        background-color:rgba(0, 0, 0, 0.8);
    }

    .thumb {
        /*position: relative;*/
        overflow:hidden;
        height: 84px;
    }

    .thumb img {
        width: 100%;
        position: relative;
        top: -13px;
    }

    .vid-item .desc {
        color: white;
        font-size: 15px;
        margin-top:5px;
        
        white-space: nowrap; 
        overflow: hidden;
        text-overflow:ellipsis;
    }
  
    /* .vid-item .desc:after {
        content: '';
        position: absolute;
        right: 0;
        width: 1em;
        height: 1em;
        margin-top: 0.2em;
        background: white;
      } */
    .vid-item:hover {
        background:darkgrey;
        cursor: pointer;
    }

    .arrows {
        position:relative;
        width: 100%;
    }

    .arrow-left {
        color: lightcoral;
        position: absolute;
        /* background: #777; */
        /* padding: 16px; */
        left: -48px;
        top: -108px;
        z-index:100;
        cursor: pointer;
        /* border: 1px solid white; */
    }

    .arrow-right {
        color: lightcoral;
        position: absolute;
        /* background: #777; */
        /* padding: 16px; */
        right: -48px;
        top: -108px;
        z-index:100;
        cursor: pointer;
        /* border: 1px solid white; */
    }

    .arrow-left:hover {
        color: #CC181E;
    }

    .arrow-right:hover {
        color: #CC181E;
    }

</style>
<body>
  <!-- Navbar (sit on top) -->
    <div class="w3-top">
        <div class="w3-bar w3-red w3-padding w3-card" style="letter-spacing:4px;">
            <a ref="#" class="w3-bar-item w3-button w3-text-white w3-hover-white">MM802 Mini Project</a>
            <!-- <a href="#" class="w3-bar-item w3-button w3-padding-large">Link 1</a> -->
            <!-- Right-sided navbar links. Hide them on small screens -->
            <div class="w3-right w3-hide-small">
                <span class="w3-bar-item w3-text-white w3-hover-red">By Atom & Yohannes</span>
            </div>
        </div>
    </div>

    <header class="w3-container w3-light-grey w3-center" style="padding:96px 0 32px 0;">
        <h2 class="w3-margin ">Canada Trending YouTube Video</h2>
        <!-- <p class="w3-xlarge" >Canada Trending YouTube Video</p> -->
        <!-- <button class="w3-button w3-black w3-padding-large w3-large w3-margin-top">Get Started</button> -->
    </header>

    <div class="w3-content" style="max-width:1100px; padding: 0 0 128px 0;">
        <button class="tablink" onclick="openPage('MostViews', this, 'red'); getMostViewed();" id="defaultOpen">Most Views</button>
        <button class="tablink" onclick="openPage('MostLikes', this, 'green'); getMostLikedVideos()">Most Likes</button>
        <button class="tablink" onclick="openPage('MostDislikes', this, 'blue')">Most Dislikes</button>
        <button class="tablink" onclick="openPage('MostComments', this, 'orange')">Most Comments</button>

    </div>

    <div class="w3-white w3-center">
        <div class="container"  style="padding:0 0 0px 0">
            <h1>Most Viewed Videos</h1>
        </div>
        <h4 style="margin: 0 0 -20px 0"><img id="vid-medal" style="width:32px; margin: 0px 8px 0px 8px; padding-bottom:12px" src="imgs/bronze-medal.png" ></img><b id="vid-rank" style="color:#CC181E;font-size:32px">No.1. </b><b id="vid-title"> YouTube Rewind: The Shape of 2017 | #YouTubeRewind</b></h4>
        <div class="container"  style="padding:0 0 60px 0">
            <div class="container"  style="padding:0 0 0 0">
                
            </div>
            <div class="vid-container">
                <iframe id="vid_frame" src="" frameborder="0" width="320" height="240"></iframe>
            </div>
            <div class="vid-list-container">
                <div class="vid-list">                  
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                    <div class="vid-item" onClick="">
                        <div class="thumb"><img src=""></div>
                        <div class="desc"></div>
                    </div>
                </div>          
            </div>
        
            <div class="arrows">
                <div class="arrow-left"><i class="fa fa-chevron-circle-left" style="font-size:48px"></i></div>
                <div class="arrow-right"><i class="fa fa-chevron-circle-right" style="font-size:48px"></i></div>        
            </div>
        </div>

        <table id="Table" align="center" style="padding:0 0 80px 0">

        </table>
    
        <svg id="BarGraph">
    
        </svg>
    </div>

    

    <div id="MostViews" class="tabcontent w3-container w3-white w3-center">
     

    </div>
  
    <div id="MostLikes" class="tabcontent w3-container w3-white w3-center">
    <h3>Most Liked Videos</h3>
    <p>Which videos get most likes?</p> 
    <script>
        function getMostLikedVideos(){
        alert("Which videos get most likes?");
        }
    </script>
    </div>
  
    <div id="MostDislikes" class="tabcontent w3-container w3-white w3-center">
        <h3>Most Disliked Videos</h3>
        <p>Which videos get most dislikes?</p>
        <script>
        function getMostDislikedVideos(){
            alert("Which videos get most dislikes?");
        }
        </script>
    </div>
  
    <div id="MostComments" class="tabcontent w3-container w3-white w3-center">
        <h3>Most Commented Videos</h3>
        <p>Which videos get most comments?</p>
        <script>
            function getMostCommentedVideos(){
            alert("Which videos get most comments?");
            }
        </script>
    </div>

    <script async>
        function async(your_function, callback) {
            setTimeout(function() {
                your_function();
                if (callback) {callback();}
            }, 0);
        }

        var data=null;
        var mostViewed=null;
        var selectedVideoIndex = 0;          

        d3.csv("data/youtube_data_ca.csv",
            function(d){
                d.views = +d.views;
                d.likes = +d.likes;
                d.dislikes = +d.dislikes;
                d.comment_count = +d.comment_count;
                return d;
            },
            function(error,d){
                data=d;
        });

        async function getMostViewed(){
            console.log("getMostViewed");
            if(data==null){
                console.log("data==null!");
                data = d3.csv("data/youtube_data_ca.csv",
                    function(d){
                        d.views = +d.views;
                        d.likes = +d.likes;
                        d.dislikes = +d.dislikes;
                        d.comment_count = +d.comment_count;
                        return d;
                    },
                    function(error,data){
                        getMostViewed();
                });
                return;
            }

            if(mostViewed==null){
                dataSortedByViews = data.slice(0)
                dataSortedByViews.sort(
                    function(a,b){
                        return b.views-a.views;
                    });
                
                videoIdSet = [];
                for(var i=0; i<dataSortedByViews.length; ){
                    var videoId = dataSortedByViews[i].video_id;
                    if(videoIdSet.indexOf(videoId)<0){
                        videoIdSet.push(videoId);
                        i+=1;
                    }else{
                        dataSortedByViews.splice(i, 1);
                    }
                }
        
                delete videoIdSet;
                mostViewed = dataSortedByViews.slice(0,10);
            }
                
            loadVideoPlayer(mostViewed);
            loadTable(mostViewed);
            loadBarGraph(mostViewed);
        }

        function onClickVideoThumbnail(index){
            // console.log("onClickVideoThumbnail");
            // console.log(index);
            // console.log(mostViewed);
            var videoId = mostViewed[index].video_id;

            document.getElementById('vid_frame').src="http://youtube.com/embed/"+videoId+"?autoplay=1&rel=0&showinfo=0&autohide=1";
                       
            var vidItems = document.getElementsByClassName("vid-item");
            vidItems = Array.prototype.slice.call(vidItems);
            
            vidItems[selectedVideoIndex].style.backgroundColor = "rgba(0, 0, 0, 0.8)";

            selectedVideoIndex = index;

            vidItems[selectedVideoIndex].style.backgroundColor = "rgba(80, 80, 80, 0.8)";

            document.getElementById('vid-title').innerHTML = mostViewed[index].title;
            document.getElementById('vid-rank').innerHTML = "No."+(index+1)+" ";
            if(index==0){
                document.getElementById('vid-medal').setAttribute("src","imgs/gold-medal.png");
            }else if(index==1){
                document.getElementById('vid-medal').setAttribute("src","imgs/silver-medal.png");
            }else if(index==2){
                document.getElementById('vid-medal').setAttribute("src","imgs/bronze-medal.png");
            }else{
                document.getElementById('vid-medal').setAttribute("src","");
            }
            
        }

        function loadVideoPlayer(mostViewed){
            console.log("loadVideoPlayer");

            var vidItems = document.getElementsByClassName("vid-item");

            for(var i=0;i<vidItems.length;i+=1){
                var vidItem = vidItems[i];

                vidItem.setAttribute("onClick","onClickVideoThumbnail("+i+")");
                
                for (var j = 0; j < vidItem.childNodes.length; j++) {
                    if (vidItem.childNodes[j].className == "thumb") {
                        var node = vidItem.childNodes[j];
                        
                        node.childNodes[0].src=mostViewed[i].thumbnail_link;
                        break;
                    }        
                }
                
                for (var j = 0; j < vidItem.childNodes.length; j++) {
                    if (vidItem.childNodes[j].className == "desc") {
                        var node = vidItem.childNodes[j];
                        node.innerHTML=mostViewed[i].title;
                        break;
                    }        
                }
                
                onClickVideoThumbnail(0);
            }
        }

        function loadTable(mostViewed){
            console.log("loadMostViewedTable");

            
            var tableElement = document.getElementById("Table");
            while (tableElement.firstChild) {
                tableElement.removeChild(tableElement.firstChild);
            }
            console.log(tableElement);

            var table = $("#Table")
            console.log(table);

            table.append($("<caption></caption>").html("Most Viewed Videos"))
            var thead = $("<thead></thead>");
            thead.append($("<th></th>").html("Rank"))
            thead.append($("<th></th>").html("Image"))
            thead.append($("<th></th>").html("Title"))
            thead.append($("<th></th>").html("#Views"))
            thead.append($("<th></th>").html("Url"))

            table.append(thead);
            table.append($("<tbody></tbody>"))

            for(var i=0;i<mostViewed.length;i+=1){
                var tr = $("<tr></tr>");
    
                tr.append($("<td style='text-align: center;'></td>").html(i+1));

                var img = $('<img />').attr("src", mostViewed[i].thumbnail_link);
                tr.append($("<td></td>").append(img));
                
                tr.append($("<td style='font-size:14px;'></td>").html(mostViewed[i].title));
        
                tr.append($("<td></td>").html(mostViewed[i].views));
                
                var url = $("<a>").attr("href","https://www.youtube.com/watch?v="+mostViewed[i].video_id);
                url.html("https://www.youtube.com/watch?v="+mostViewed[i].video_id);
                tr.append($("<td style='font-size:14px;'></td>").append(url));

                $("tbody").append(tr);
            }

            // $("#MostViews").append("<br>");
            // $("#MostViews").append("<br>");
            // $("#MostViews").append("<br>");
            // $("#MostViews").append("<br>");
        }

        function loadBarGraph(mostViewed){
            console.log("loadBarGraph");

            var margin = {top: 20, right: 20, bottom: 60, left: 20},
            width = 960 - margin.left - margin.right,
            height = 720 - margin.top - margin.bottom;

            var formatPercent = d3.format(".0%");

            var x = d3.scale.ordinal()
                .rangeRoundBands([20, width], .1);

            var y = d3.scale.linear()
                .range([height, 0]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")           
                .tickFormat(function(d) { return Math.round(d); });
                //.ticks(10,"d");

            var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                //return "<strong>Views:</strong> <span style='color:red'>" + d.views + "</span>";
                return "<span style='color:white'>" + d.title+ "</span>"+"<br><br>"+
                "<strong>#Views:</strong> <span style='color:yellow'>" + d.views + "</span>";
            })
            
            //var svg = d3.select("#MostViews").append("svg")
            var barGraphElement = document.getElementById("BarGraph");
            while (barGraphElement.firstChild) {
                barGraphElement.removeChild(barGraphElement.firstChild);
            }
            console.log(barGraphElement);

            var svg = d3.select("#BarGraph")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.call(tip);

            x.domain(mostViewed.map(function(d) { return d.video_id; }));
            y.domain([0, d3.max(mostViewed, function(d) { return d.views; })]);

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);
            
            svg.select(".x.axis")
                .selectAll("text")
                // .attr("transform"," translate(0,15) rotate(-30)")
                .style("font-size","12px");

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
            .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Number of Views");

            svg.selectAll(".bar")
                .data(mostViewed)
            .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.video_id); })
                .attr("width", x.rangeBand())
        
                .attr("y", function(d) { return y(d.views); })
                .attr("height", function(d) { return height - y(d.views); })
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide)
        }

        $(".arrow-right").bind("click", function (event) {
            event.preventDefault();

            var vidItems = document.getElementsByClassName("vid-item");
            if(selectedVideoIndex<vidItems.length-1){
                onClickVideoThumbnail(selectedVideoIndex+1);
                // vidItems[selectedVideoIndex].style.backgroundColor = "rgba(0, 0, 0, 0.8)";
                // selectedVideoIndex+=1;
                // vidItems[selectedVideoIndex].style.backgroundColor = "rgba(80, 80, 80, 0.8)";
                // document.getElementById('vid_frame').src="http://youtube.com/embed/"+mostViewed[selectedVideoIndex].video_id+"?autoplay=1&rel=0&showinfo=0&autohide=1";
            }

            // $(".vid-list-container").stop().animate({
            //     scrollLeft: "+=336"
            // }, 750);
        });
        $(".arrow-left").bind("click", function (event) {
            event.preventDefault();

            var vidItems = document.getElementsByClassName("vid-item");
            if(selectedVideoIndex>0){
                onClickVideoThumbnail(selectedVideoIndex-1);
                // vidItems[selectedVideoIndex].style.backgroundColor = "rgba(0, 0, 0, 0.8)";
                // selectedVideoIndex-=1;
                // vidItems[selectedVideoIndex].style.backgroundColor = "rgba(80, 80, 80, 0.8)";
                // document.getElementById('vid_frame').src="http://youtube.com/embed/"+mostViewed[selectedVideoIndex].video_id+"?autoplay=1&rel=0&showinfo=0&autohide=1";
            }
            // $(".vid-list-container").stop().animate({
            //     scrollLeft: "-=336"
            // }, 750);
        });

        function openPage(pageName,elmnt,color) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "";
            }
            document.getElementById(pageName).style.display = "block";

            elmnt.style.backgroundColor = color;
        }
        document.getElementById("defaultOpen").click();
    </script>
  
</body>
</html>
